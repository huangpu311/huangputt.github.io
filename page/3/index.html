<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>小江的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="小江的个人博客">
<meta property="og:url" content="https://huangpu311.github.io/xiaojiang/page/3/index.html">
<meta property="og:site_name" content="小江的个人博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小江的个人博客">
  
    <link rel="alternate" href="/xiaojiang/atom.xml" title="小江的个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/xiaojiang/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/xiaojiang/" id="logo">小江的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/xiaojiang/">Home</a>
        
          <a class="main-nav-link" href="/xiaojiang/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/xiaojiang/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://huangpu311.github.io/xiaojiang"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/03/29/hello-world/" class="article-date">
  <time datetime="2018-03-29T13:06:44.838Z" itemprop="datePublished">2018-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/03/29/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/03/29/hello-world/" data-id="ck8h6wq6m0006ecvab3n34d5i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-spring-cloud" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/03/22/spring-cloud/" class="article-date">
  <time datetime="2018-03-22T06:30:37.000Z" itemprop="datePublished">2018-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/03/22/spring-cloud/">spring-cloud</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="spring-cloud-config"><a href="#spring-cloud-config" class="headerlink" title="spring-cloud-config"></a>spring-cloud-config</h2><p>Accpilcation EveironmentPre</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/03/22/spring-cloud/" data-id="ck8h6wq7b000hecvakyhcf1hf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/03/22/nginx/" class="article-date">
  <time datetime="2018-03-22T00:56:57.000Z" itemprop="datePublished">2018-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/03/22/nginx/">nginx</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="nginx命令"><a href="#nginx命令" class="headerlink" title="nginx命令"></a>nginx命令</h2><h3 id="nginx三个模块"><a href="#nginx三个模块" class="headerlink" title="nginx三个模块"></a>nginx三个模块</h3><p>核心模块： HTTP模块、EVENT模块和MAIL模块<br>基础模块： HTTP Access模块、HTTP FastCGI模块、HTTP Proxy模块和HTTP Rewrite模块<br>第三方模块： HTTP Upstream Request Hash模块、Notice模块和HTTP Access Key模块及用户自己开发的模块</p>
<h3 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h3><p>1、tar -zxvf  安装包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./configure: error: C compiler cc is not found</span><br><span class="line">如果报错了则执行下面</span><br><span class="line">yum -y install gcc gcc-c++ autoconf automake make</span><br><span class="line"></span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library</span><br><span class="line">yum -y install pcre-devel</span><br><span class="line"></span><br><span class="line">yum install -y zlib-devel</span><br></pre></td></tr></table></figure>
<p>2、.进入文件夹 运行 ./configure –prefix=  目录，默认安装到/usr/local/nginx</p>
<p>3、运行 make &amp; make install</p>
<p>启动命令</p>
<p>进入sbin文件夹 ，运行./nginx即可</p>
<p>./nginx -s stop  停止</p>
<p>./nginx -s quit   退出</p>
<p>./nginx -s reload  重新加载nginx.conf</p>
<p>查看nginx是否运行</p>
<p>ps -ef| grep nginx</p>
<p>验证nginx.conf是否报错</p>
<p>./nginx -t</p>
<p>重新加载nginx 文件</p>
<p>./nginx -s reload</p>
<h3 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h3><p>基于域名的虚拟主机</p>
<p>修改host 文件</p>
<p>基于端口号的虚拟主机</p>
<p>基于ip的虚拟主机</p>
<h3 id="nginx-日志配置"><a href="#nginx-日志配置" class="headerlink" title="nginx 日志配置"></a>nginx 日志配置</h3><p>通过access_log进行日志记录</p>
<p>error.log</p>
<p>nginx 日志切割</p>
<h3 id="location的语法和匹配规则"><a href="#location的语法和匹配规则" class="headerlink" title="location的语法和匹配规则"></a>location的语法和匹配规则</h3><p>功能描述：执行 URL 重定向,允许你去掉带有恶意的 URL，包含多个参数（修改）.利用正则的匹配，分组和引用，达到目的</p>
<p>来源: 实验楼</p>
<p>链接: <a href="https://www.shiyanlou.com/courses/95" target="_blank" rel="noopener">https://www.shiyanlou.com/courses/95</a></p>
<p>本课程内容，由作者授权实验楼发布，未经允许，禁止转载、下载及非法传播</p>
<p>精准匹配</p>
<p>优先级最高的匹配规则</p>
<p>一般匹配</p>
<p>如果存在多个相同前缀的一般匹配，那么最终会按照最大长度的进行匹配。</p>
<p>正则匹配</p>
<h3 id="rewaite模块"><a href="#rewaite模块" class="headerlink" title="rewaite模块"></a>rewaite模块</h3><p>模块：ngx_http_rewrite_module</p>
<p>支持url 重写；if判断、return </p>
<p>作用范围：server/location/if中；只能对域名，后面的出处的参数外的字符串起作用。</p>
<p>if(条件){}</p>
<p>=号或者~;</p>
<p>return 指令</p>
<p>return code </p>
<p>if($request_uri~ *\sh){</p>
<p>​    return 403</p>
<p>}</p>
<p>语法： rewrite regex replacement [flag]{last/break/redirect 返回临时302/permant 返回永久302}</p>
<p>重写连接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      rewrite '^/images/([a-z]&#123;3&#125;)/(.*)\.(png)$' /mic?file=$2.$3 break ;</span><br><span class="line">      set $image_file $2;</span><br><span class="line">      set $image_type $3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /mic &#123;</span><br><span class="line">      access_log logs/hp.log main;</span><br><span class="line">      root html;</span><br><span class="line">      try_files /$arg_file /image404.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /image404.html&#123;</span><br><span class="line">      return 404 "imgage not found exception";</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>图片缓存</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location /&#123;</span><br><span class="line">      root html;</span><br><span class="line">      index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~\.(png|jpg|js|css|gif)$ &#123;</span><br><span class="line">      root html/images;</span><br><span class="line">      expires 5m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Gzip压缩策略</p>
<p>浏览器请求服务端 会告诉服务端当前浏览器可以支持的压缩类型；</p>
<p>服务端会把内容根据浏览器所支持的压缩策略去进行压缩返回;</p>
<p>浏览器拿到数据以后解码；</p>
<p>gzip、deflate、sdch</p>
<h3 id="Proxy-模块"><a href="#Proxy-模块" class="headerlink" title="Proxy 模块"></a>Proxy 模块</h3><p>模块：ngx_http_proxy_module</p>
<p>功能描述：此模块能代理请求到其它服务器.也就是说允许你把客户端的 HTTP 请求转到后端服务器(这部分的指令非常多，但不是全部都会被用到，这里是比较常见的指令简介)</p>
<h3 id="upstream-模块"><a href="#upstream-模块" class="headerlink" title="upstream 模块"></a>upstream 模块</h3><p>模块：ngx_http_upstream_modules</p>
<p>功能简介：该指令使请求被上行信道之间的基于客户端的 IP 地址分布</p>
<h3 id="模拟文件命令"><a href="#模拟文件命令" class="headerlink" title="模拟文件命令"></a>模拟文件命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############每个指令必须要用分号结束##############</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">user administrator administrators; <span class="comment">#配置用户或组，默认nobody nobody</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">worker_processes 2 ;<span class="comment"># 允许生成的进程数，默认为1</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">pid /nginx/pid/nginx.pid; <span class="comment"># 指定nginx进程允许文件存放地址</span></span></span><br><span class="line">error_log log/error.log debug ; # 制定日志路径级别，这个设置可以放入全局块，http块，server块，级别依次为debug|info|notice|warn|error|crit|alert|emerg</span><br><span class="line">events &#123;</span><br><span class="line">    accept_mutes on; #设置网路连接序列化，防止出现惊群现象发生，默认为on</span><br><span class="line">    multi_accept on; #设置一个进程是否同时</span><br><span class="line">    #use  epoll; #事件驱动模型 select|poll|kqueue|epoll|resig|dev|poll|eventport</span><br><span class="line">    work_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include mime.types;# 文件扩展名与文件类型映射表</span><br><span class="line">    default_type application/octet-stream；#默认文件类型，默认为text/plain</span><br><span class="line">    access_log off;#取消服务日志</span><br><span class="line">    log_format myFormat '$remote_addr-'</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nginx-的配置"><a href="#nginx-的配置" class="headerlink" title="nginx 的配置"></a>nginx 的配置</h2><p> nginx使用一个master 进程来管理多个worker进程，一般情况下，worker进程的数量与服务器上的cpu核心数相等。worker是真正提供互联网服务的。</p>
<h3 id="Nginx的通用语法"><a href="#Nginx的通用语法" class="headerlink" title="Nginx的通用语法"></a>Nginx的通用语法</h3><ul>
<li><p>块配置 </p>
<blockquote>
<p>块配置项由一个块配置项名和一对大括号组成。如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; events&#123;</span><br><span class="line">&gt;     ....</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; http &#123;</span><br><span class="line">&gt;     upstream backend &#123;</span><br><span class="line">&gt;         server 127.0.0.1:8080</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     gzip on ;</span><br><span class="line">&gt;     server &#123;</span><br><span class="line">&gt;         ...</span><br><span class="line">&gt;             location /webstatic &#123;</span><br><span class="line">&gt;              	gizp: off;</span><br><span class="line">&gt;         &#125;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>块配置项可以嵌套。内层块直接继承外层块。</p>
</blockquote>
</li>
<li><p>配置的语法格式</p>
<blockquote>
<p>基本配置语法： 配置项名  配置项值1  配置项值2</p>
<p>每行配置的结尾需要加上分号</p>
</blockquote>
</li>
<li></li>
</ul>
<p>配置参考 <a href="https://www.cnblogs.com/chenhuan821361335/p/8185027.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenhuan821361335/p/8185027.html</a></p>
<p><a href="https://blog.csdn.net/code_shadow/article/details/81546471" target="_blank" rel="noopener">https://blog.csdn.net/code_shadow/article/details/81546471</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/03/22/nginx/" data-id="ck8h6wq74000decva80vgpc06" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-医疗" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/27/医疗/" class="article-date">
  <time datetime="2018-02-27T10:59:24.000Z" itemprop="datePublished">2018-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/27/医疗/">医疗</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="绿色就诊系统产品需求分析"><a href="#绿色就诊系统产品需求分析" class="headerlink" title="绿色就诊系统产品需求分析"></a>绿色就诊系统产品需求分析</h2><h3 id="1、目的"><a href="#1、目的" class="headerlink" title="1、目的"></a>1、目的</h3><p>在医疗纠纷和医疗事故普遍存在的当下，如何能够放心的对疾病进行治疗已经成为当下亟待解决的社会矛盾，针对这一矛盾，我认为应该从以下几方面进行解决。</p>
<h4 id="1、医疗药品公开透明化"><a href="#1、医疗药品公开透明化" class="headerlink" title="1、医疗药品公开透明化"></a>1、医疗药品公开透明化</h4><p>让社会各阶层人士能够买到放心药、实在药，要做到药品制造、运输、售价等各个方面的公开化，让民众收益，这样才能减少医患纠纷等事情的发生。</p>
<h4 id="2、医生评价公开化"><a href="#2、医生评价公开化" class="headerlink" title="2、医生评价公开化"></a>2、医生评价公开化</h4><p>许多好医生因为许多原因，不能够被医院所认可，对医生进行评价，让事实说话，这样才能让好的医生获得其自身的价值。同时，也可以让激励医生不断的进步。</p>
<h4 id="3、医疗诊断网络化"><a href="#3、医疗诊断网络化" class="headerlink" title="3、医疗诊断网络化"></a>3、医疗诊断网络化</h4><p>许多人因为地域原因一些小病不能够进行及时的治疗，如果通过互联网找医生进行治疗，可以及时的治疗小病，并且可以预防一些大病的发生。</p>
<h4 id="4、部分患者诊疗透明化"><a href="#4、部分患者诊疗透明化" class="headerlink" title="4、部分患者诊疗透明化"></a>4、部分患者诊疗透明化</h4><p>可以通过部分患者的同意，将患者的就诊过程发布出来，供其他患者参考。</p>
<h4 id="5、救助基金网络化"><a href="#5、救助基金网络化" class="headerlink" title="5、救助基金网络化"></a>5、救助基金网络化</h4><p>当产生大病或者困难家庭就诊时，通过其他病友或者网络进行捐款，付款全部走平台，如果捐款有剩余，可以通过百分比进行退回</p>
<h4 id="6、第三方监管并且每季度发布相关成果"><a href="#6、第三方监管并且每季度发布相关成果" class="headerlink" title="6、第三方监管并且每季度发布相关成果"></a>6、第三方监管并且每季度发布相关成果</h4><p>通过平台进行第三方监管，让患者能够放心就诊，基金能够得到合理利用</p>
<h4 id="7、急诊绿色通道网络化"><a href="#7、急诊绿色通道网络化" class="headerlink" title="7、急诊绿色通道网络化"></a>7、急诊绿色通道网络化</h4><p>如果一个边远城市的人患了急病，需要到上海进行就诊，可以通过网络确认其就诊路线，并且得到路途中其他人员的协助，最快的速度进行救治。</p>
<h3 id="2、产品主体"><a href="#2、产品主体" class="headerlink" title="2、产品主体"></a>2、产品主体</h3><h4 id="患者"><a href="#患者" class="headerlink" title="患者"></a>患者</h4><p>通过产品可以让患者能够快速的就医，可以通过 搜索症状、附近医院、附近好医生、分类好医生排行榜、分类患者交流等方式进行就诊或者治疗</p>
<h4 id="医生"><a href="#医生" class="headerlink" title="医生"></a>医生</h4><p>医生可以进行个人注册，医生可以发布文章，远程治疗（开处方到在药店直接邮寄拿药）、免费咨询等方式获取好评，吸引更多的患者前来就医。</p>
<p>医生的文章可以获得赞赏，医生个人也可以得到赞赏，通过患者的鼓励可以更好的支持医生的工作。</p>
<h4 id="医疗机构"><a href="#医疗机构" class="headerlink" title="医疗机构"></a>医疗机构</h4><p>医疗机构可以进行注册，患者可以更方便的找到最近的医院。</p>
<p>医院可以发布动态，更好的宣传自己，</p>
<p>医院可以设立咨询机构，免费通过网络进行咨询。</p>
<p>医院由第三方机构和软件使用患者进行评级，能让患者更好的医院。</p>
<h4 id="药店"><a href="#药店" class="headerlink" title="药店"></a>药店</h4><p>主要支持医生进行远程开处方等形式存在，并且可以邮寄，不接受个人买药。</p>
<h4 id="药品"><a href="#药品" class="headerlink" title="药品"></a>药品</h4><p>对每种药品进行介绍，方便患者更清楚的使用药品</p>
<h4 id="医疗器材"><a href="#医疗器材" class="headerlink" title="医疗器材"></a>医疗器材</h4><p>可以单独售卖，对患者进行辅助性治疗</p>
<h4 id="普通人群"><a href="#普通人群" class="headerlink" title="普通人群"></a>普通人群</h4><p>可以关注相关健康文章，预防和知道最新的疾病信息。</p>
<h4 id="基金"><a href="#基金" class="headerlink" title="基金"></a>基金</h4><h3 id="3、产品功能"><a href="#3、产品功能" class="headerlink" title="3、产品功能"></a>3、产品功能</h3><p>每个人进入产品都是以普通人群的方式进入，产品应该以预防疾病等方式存在，并且提供最新的医疗咨询。</p>
<p>医生查询：</p>
<p>可以查询到这个医生的详细信息、医生的诊疗评价、医生的推荐指数、医生的文章，医生咨询反馈率，同时可以对医生进行免费咨询和赞赏。</p>
<p>医院查询：</p>
<p>可以查询到医院的详细信息、医院的评价、医院的文章、医院的反馈率和免费咨询。</p>
<p>附近医院</p>
<p>附近药店</p>
<p>医疗器材查询：</p>
<p>查询居民可以购买的医疗器材，可以作为商品进行售卖。</p>
<p>医疗基金</p>
<p>医疗基金统计、捐赠医疗基金、最新捐赠人员等。</p>
<p>药品查询：</p>
<p>可以查询到药品的详细信息</p>
<p>综合查询</p>
<p>查询以上分类的任何东西</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/27/医疗/" data-id="ck8h6wq7y000recva2v9u1fgw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-dubbo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/27/dubbo/" class="article-date">
  <time datetime="2018-02-27T08:18:35.000Z" itemprop="datePublished">2018-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/27/dubbo/">dubbo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p><a href="http://dubbo.io/" target="_blank" rel="noopener">http://dubbo.io/</a></p>
<p>文档地址 <a href="http://dubbo.io/books/dubbo-user-book/" target="_blank" rel="noopener">http://dubbo.io/books/dubbo-user-book/</a></p>
<p>dubbo是一个分布式的服务框架，提供高性能的以及透明化的RPC远程服务调用解决方案，以及AOA服务治理方案。</p>
<p>##Dubbo的核心部分</p>
<p>远程通信</p>
<p>集群容错</p>
<p>服务的自动发现</p>
<p>负载均衡</p>
<h2 id="Dubbo的架构"><a href="#Dubbo的架构" class="headerlink" title="Dubbo的架构"></a>Dubbo的架构</h2><p>核心角色</p>
<h2 id="集群容错"><a href="#集群容错" class="headerlink" title="集群容错"></a>集群容错</h2><p>failsafe 失败安全，可以任务把错误吞掉（记录日志） </p>
<p>failover 默认   重试服务器 retrie (2)</p>
<p>failfast 快速失败，失败后立马报错</p>
<p>failback 失败后恢复</p>
<p>forking  forks设置并行的最大数</p>
<p>broadcast 广播，任意一台报错，则执行的方法报错</p>
<p>通过cluster配置</p>
<p>配置的优先级别 </p>
<p> 客户端由于服务端</p>
<p>1、方法级别优先，然后是接口 ，然后是全局</p>
<p>2、如果级别是一样的，客户端优先</p>
<h2 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h2><h2 id="java-spi"><a href="#java-spi" class="headerlink" title="java  spi"></a>java  spi</h2><p>1，在META-INF/service下面定义 java.sql.Driver下定义类</p>
<p>2.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/27/dubbo/" data-id="ck8h6wq6j0004ecva5t4p0rsx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/27/docker/" class="article-date">
  <time datetime="2018-02-27T00:59:35.000Z" itemprop="datePublished">2018-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/27/docker/">docker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="docker-安装"><a href="#docker-安装" class="headerlink" title="docker 安装"></a>docker 安装</h2><p>参考资料 <a href="https://www.cnblogs.com/yufeng218/p/8370670.html" target="_blank" rel="noopener">docker安装</a></p>
<p>命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置yum源</span></span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看仓库中的所有版本</span></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装docker </span></span><br><span class="line">yum install docker-ce</span><br></pre></td></tr></table></figure>
<p>idea控制docker </p>
<p><a href="https://my.oschina.net/wuweixiang/blog/2874064" target="_blank" rel="noopener">https://my.oschina.net/wuweixiang/blog/2874064</a></p>
<p>##Docker命令</p>
<h4 id="docker组成"><a href="#docker组成" class="headerlink" title="docker组成"></a>docker组成</h4><ol>
<li>dockerClient客户端</li>
<li>Docker Daemon守护进程</li>
<li>Docker Image镜像</li>
<li>DockerContainer容器</li>
</ol>
<p>容器：对象</p>
<p>镜像：类</p>
<p>–name  docker 命名</p>
<p>1、docker  拉取tomcat镜像</p>
<p>docker pull tomcat</p>
<p>2、docker运行tomcat 容器</p>
<p>docker run -d -p 9000:8080 tomcat:7</p>
<p>netstat -antp|grep 3306</p>
<p>docker run –name mysql5.7 -p 3306:3306 -v /hp/data/mysql/datadir:/var/lib/mysql -v /hp/data/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</p>
<p>查看tomcat路径</p>
<p>docker exec -it   name  /bin/bash</p>
<p>进入容器</p>
<p>docker run -ti centos bash</p>
<p>docker ps 查看正在运行的容器</p>
<p>docker ps -l 列出一个进行运行过的容器</p>
<p>docker ps -a 查看所有容器，包括已经停止的容器</p>
<p>docker ps -q 只展示正在运行的容器id</p>
<p>安装docker </p>
<p>yum install docker</p>
<p>启动docker</p>
<p> service docker start（systemctl start docker.service）</p>
<p>将docker设置为开机启动</p>
<p>chkconfig docker on（systemctl enable docker.service）</p>
<p>获取centos镜像到本地</p>
<p>docker pull centos</p>
<h3 id="docker安装镜像比较慢"><a href="#docker安装镜像比较慢" class="headerlink" title="docker安装镜像比较慢"></a>docker安装镜像比较慢</h3><p>进入这个网站进行注册 <a href="https://account.daocloud.io/signin，点击加速器进入https://www.daocloud.io/mirror#accelerator-doc，然后复制命令在linux里面运行即可。" target="_blank" rel="noopener">https://account.daocloud.io/signin，点击加速器进入https://www.daocloud.io/mirror#accelerator-doc，然后复制命令在linux里面运行即可。</a></p>
<p>linux加速器配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io</span><br></pre></td></tr></table></figure>
<p>运行后可能会出现docker起不来，这个是因为/etc/docker 下的daemon.json文件不是json格式导致的</p>
<p>运行后重启docker(service docker restart )</p>
<p>docker run 命令格式</p>
<p>-d,–detach=false  指定容器运行于前台还是后台，默认false</p>
<p>-i,–interactive=false  打开TIDIN,用于控制台交互</p>
<p>-t,-tty=false   分配tty设置，该可以支持终端登录，默认false</p>
<p>-u, –user=”” 指定容器的用户</p>
<p>-a , –attach=[] 登录容器(必须是以docker run -d 启动容器)</p>
<p>-w,–workdir=”” 指定容器的工作目录</p>
<p>-c,–cpu-shares =0,设置容器cpu权重，在cpu共享场景使用</p>
<p>-e,–env=[] 指定环境变量，容器中可以使用该环境变量</p>
<p>-m,–memory =”” 指定容器内存上限</p>
<p>-P, –publish-all =false 指定暴露的端口</p>
<p>-p ,–publish=[] 指定容器暴露端口</p>
<p>-h ,–hostname =”” 指定容器主机名</p>
<p>-v ,–volume=[] 给容器挂载存储卷，挂载到容器的某个目录</p>
<h2 id="docker-安装第三方软件"><a href="#docker-安装第三方软件" class="headerlink" title="docker 安装第三方软件"></a>docker 安装第三方软件</h2><h3 id="docker-安装mysql"><a href="#docker-安装mysql" class="headerlink" title="docker 安装mysql"></a>docker 安装mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拉取5.7版本的mysql</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run --name mysql5.7 -p 3307:3306 -v /hp/mysql/datadir:/var/lib/mysql -v /hp/mysql/conf:/etc/mysql/ -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run --name slave -p 3308:3306 -v /hp/mysql/slave/datadir:/var/lib/mysql -v /hp/mysql/slave/conf:/etc/mysql/ -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>
<p>docker 下的mysql数据库主从配置<a href="https://blog.csdn.net/boling_cavalry/article/details/79751085" target="_blank" rel="noopener">链接</a></p>
<p><a href="https://www.cnblogs.com/ivictor/p/6440429.html" target="_blank" rel="noopener">https://www.cnblogs.com/ivictor/p/6440429.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &apos;rep&apos;@&apos;%&apos; IDENTIFIED BY &apos;888888&apos;;</span><br><span class="line"></span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO &apos;rep&apos;@&apos;%&apos;;</span><br><span class="line"></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">SHOW MASTER STATUS;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#172.17.0.2</span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_HOST=&apos;188.131.227.43&apos;, \</span><br><span class="line">MASTER_USER=&apos;rep&apos;, \</span><br><span class="line">MASTER_PASSWORD=&apos;888888&apos;, \</span><br><span class="line">MASTER_LOG_FILE=&apos;mysql-master-bin.000001&apos;, \</span><br><span class="line">MASTER_PORT=3307, \</span><br><span class="line">MASTER_LOG_POS=1276;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">MASTER_DIR=/var/lib/mysql/master</span><br><span class="line">SLAVE_DIR=/var/lib/mysql/slave</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># First we could rm the existed container</span></span></span><br><span class="line">docker rm -f master</span><br><span class="line">docker rm -f slave</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Rm the existed directory</span></span></span><br><span class="line">rm -rf $MASTER_DIR</span><br><span class="line">rm -rf $SLAVE_DIR</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Start instance</span></span></span><br><span class="line">docker run --name master -p 3308:3306  -v /etc/master.cnf:/etc/mysql/my.cnf -v $MASTER_DIR:/var/lib/mysql  --net=host -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br><span class="line">docker run --name slave -p 3309:3306  -v /etc/slave.cnf:/etc/mysql/my.cnf -v $SLAVE_DIR:/var/lib/mysql --net=host -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Creating a User for Replication</span></span></span><br><span class="line">docker stop master slave</span><br><span class="line">docker start master slave</span><br><span class="line"></span><br><span class="line">sleep 3</span><br><span class="line"></span><br><span class="line">docker exec -it master mysql -S /var/lib/mysql/mysql.sock -e "CREATE USER 'repl'@'127.0.0.1' IDENTIFIED BY 'repl';GRANT REPLICATION SLAVE ON *.* TO 'repl'@'127.0.0.1';"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Obtaining the Replication Master Binary Log Coordinates</span></span></span><br><span class="line">master_status=`docker exec -it master mysql -S /var/lib/mysql/mysql.sock -e "show master status\G"`</span><br><span class="line">master_log_file=`echo "$master_status" | awk  'NR==2&#123;print substr($2,1,length($2)-1)&#125;'`</span><br><span class="line">master_log_pos=`echo "$master_status" | awk 'NR==3&#123;print $2&#125;'`</span><br><span class="line">master_log_file="'""$master_log_file""'"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Setting Up Replication Slaves </span></span></span><br><span class="line">docker exec -it slave mysql -S /var/lib/mysql/mysql.sock -e "CHANGE MASTER TO MASTER_HOST='127.0.0.1',MASTER_PORT=3306,MASTER_USER='repl',MASTER_PASSWORD='repl',MASTER_LOG_FILE=$master_log_file,MASTER_LOG_POS=$master_log_pos;"docker exec -it slave mysql -S /var/lib/mysql/mysql.sock -e "start slave;"</span><br><span class="line">docker exec -it slave mysql -S /var/lib/mysql/mysql.sock -e "show slave status\G"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Creates shortcuts</span></span></span><br><span class="line">grep "alias master" /etc/profile</span><br><span class="line">if [ $? -eq 1 ];then</span><br><span class="line">    echo 'alias mysql="docker exec -it master mysql"' &gt;&gt; /etc/profile</span><br><span class="line">    echo 'alias master="docker exec -it master mysql -h 127.0.0.1 -P3306"' &gt;&gt; /etc/profile</span><br><span class="line">    echo 'alias slave="docker exec -it master mysql -h 127.0.0.1 -P3307"' &gt;&gt; /etc/profile</span><br><span class="line">    source /etc/profile</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="docker-部署项目"><a href="#docker-部署项目" class="headerlink" title="docker 部署项目"></a>docker 部署项目</h3><p>构建docker文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM livingobjects/jre8</span><br><span class="line"> VOLUME /tmp</span><br><span class="line"><span class="meta">#</span><span class="bash">  作者签名</span></span><br><span class="line"> MAINTAINER hp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  简化 jar 的名字路径 （<span class="comment">#：表示注释掉）</span></span></span><br><span class="line"> COPY jar/dist-primary-1.1.4.jar  /app.jar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  执行 java -jar 命令 （CMD：在启动容器时才执行此行。RUN：构建镜像时就执行此行）</span></span><br><span class="line"> CMD java -jar /app.jar</span><br></pre></td></tr></table></figure>
<p>运行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -t admin .</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">docker stop admin_hp</span><br><span class="line">docker rm admin_hp</span><br><span class="line">docker run -d -p 80:8081 -v /hp/data/docker/logs:/logs --name admin_hp admin</span><br></pre></td></tr></table></figure>
<h3 id="docker-部署tomcat"><a href="#docker-部署tomcat" class="headerlink" title="docker 部署tomcat"></a>docker 部署tomcat</h3><p><a href="https://blog.csdn.net/qq_32351227/article/details/78673591" target="_blank" rel="noopener">文章地址</a></p>
<p><a href="https://blog.csdn.net/qq_32351227/article/details/78673591" target="_blank" rel="noopener">https://blog.csdn.net/qq_32351227/article/details/78673591</a> </p>
<p>docker run  -v  /hp/data/docker/cms/tomcat/webapps:/usr/local/tomcat/webapps -v   /hp/data/docker/cms/tomcat/logs:/usr/local/tomcat/logs -d  -p 8081:8080  -it  –name=cms tomcat </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/27/docker/" data-id="ck8h6wq77000fecva97ir5xnk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mongodb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/06/mongodb/" class="article-date">
  <time datetime="2018-02-06T08:08:32.000Z" itemprop="datePublished">2018-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/06/mongodb/">mongodb</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###与非关系数据库对比</p>
<p>MongoDB是一个最像关系型数据库的非关系型数据库</p>
<p>关系型数据库 ：事务、表关联、表结构操作</p>
<p>非关系型数据库：无事务、数据与数据之间没有关联、key-value</p>
<p>table collection</p>
<p>row  document</p>
<p>column  field</p>
<p>index  index</p>
<p>pk ObjectId</p>
<p>BSON是二进制的JSON</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mongod -dbpath=/usr/local/mongodb/data -logpath=/usr/local/mongodb/logs</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mongod -shutdown -dbpath=/usr/local/mongodb/data</span><br></pre></td></tr></table></figure>
<p>启动远程连接</p>
<p>./mongod -dbpath=/usr/local/mongodb/data -logpath=/usr/local/mongodb/mongodb.log -logappend -bind_ip=0.0.0.0  -port=27017  -fork</p>
<p>创建权限</p>
<p>db.createUser( {<br>​    user: “sa”,<br>​    pwd: “sa”,<br>​    roles: [ { role: “root”, db: “admin” } ]<br>  });</p>
<p>添加test库的账户</p>
<p>> db.createUser({user:’test’,pwd:’mongodb’,roles:[{role:’dbOwner’, db:’test’}]});</p>
<p>说明：</p>
<p>roles的可选项有：</p>
<p>\1. 数据库用户角色：read、readWrite;<br>\2. 数据库管理角色：dbAdmin、dbOwner、userAdmin；<br>\3. 集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；<br>\4. 备份恢复角色：backup、restore；<br>\5. 所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase<br>\6. 超级用户角色：root</p>
<p>./mongod -f mongodb.conf</p>
<p>参考地址</p>
<p><a href="https://www.cnblogs.com/paopaoquan/p/6375071.html" target="_blank" rel="noopener">https://www.cnblogs.com/paopaoquan/p/6375071.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/06/mongodb/" data-id="ck8h6wq6x000aecvawrkqewgv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/05/git/" class="article-date">
  <time datetime="2018-02-05T02:17:19.000Z" itemprop="datePublished">2018-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/05/git/">git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="git-http方式保存-密码"><a href="#git-http方式保存-密码" class="headerlink" title="git http方式保存 密码"></a>git http方式保存 密码</h3><p>clone下来后，在.git/config 里面添加<br>[credential]<br>    helper = store</p>
<h3 id="git基础知识"><a href="#git基础知识" class="headerlink" title="git基础知识"></a>git基础知识</h3><h5 id="git-优势"><a href="#git-优势" class="headerlink" title="git 优势"></a>git 优势</h5><p>本地存储，速度快</p>
<p>分布式存储，不完全依赖中央仓库</p>
<h5 id="文件的三种状态"><a href="#文件的三种状态" class="headerlink" title="文件的三种状态"></a>文件的三种状态</h5><p> 已提交（committed）、已修改（modified）和已暂存（staged）、</p>
<p>已跟踪的(tracked)</p>
<p>已提交表示数据已经安全的保存在本地数据库中。 </p>
<p>已修改表示修改了文件，但还没保存到数据库中。</p>
<p> 已暂存表示对一个已修改文件的当前版本做了标记，使之包含在下次提交的快照中。</p>
<h5 id="git的三个工作区域"><a href="#git的三个工作区域" class="headerlink" title="git的三个工作区域"></a>git的三个工作区域</h5><h6 id="Git-仓库"><a href="#Git-仓库" class="headerlink" title="Git 仓库"></a>Git 仓库</h6><p>git用来保存元数据和对象数据库的地方，</p>
<h6 id="工作目录"><a href="#工作目录" class="headerlink" title="工作目录"></a>工作目录</h6><p>对项目的某个版本独立提取出来的内容</p>
<h6 id="暂存区域"><a href="#暂存区域" class="headerlink" title="暂存区域"></a>暂存区域</h6><p>暂存区域是一个文件，保存了下次将要提交的文件列表的信息，也被称作”索引”</p>
<p>基本的git工作流程如下：</p>
<p>1、在工作目录下修改文件</p>
<p>2、暂存文件，将文件的快照放到暂存区域</p>
<p>3、提交更新，找到暂存区域的文件，将快照永久性的存储到git仓库目录</p>
<p>如果git保存着特定版本的文件，就是已提交状态</p>
<p>如果修改了已放到暂存区域，就是已暂存状态</p>
<p>如果修改了，还没有放到暂存区域就是已修改状态</p>
<h5 id="git命令"><a href="#git命令" class="headerlink" title="git命令"></a>git命令</h5><p>设置你的用户名称与邮件地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git config --global user.name <span class="string">"name"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global user.email xxx@qq.com</span></span><br></pre></td></tr></table></figure>
<p>查看设置的用户名和邮件地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure>
<p>如果加了–global，那么在你电脑上默认都是用这个信息，如果有新的项目需要更换用户名和邮箱，那么将–global去掉再运行一遍即可。</p>
<p>git帮助手册</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">help</span> &lt;verb&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git &lt;verb&gt; --<span class="built_in">help</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> man git-&lt;verb&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果需要获取config的帮助手册，输入命令 git config –help即可。</p>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">git init</td>
<td style="text-align:center">git 初始化</td>
</tr>
<tr>
<td style="text-align:center">git clone url  文件夹名称</td>
<td style="text-align:center">git 克隆代码</td>
</tr>
<tr>
<td style="text-align:center">git add .</td>
<td style="text-align:center">git 添加到跟踪状态</td>
</tr>
<tr>
<td style="text-align:center">git status</td>
<td style="text-align:center">查看文件状态</td>
</tr>
<tr>
<td style="text-align:center">git status -s</td>
<td style="text-align:center">以简短的方式查看文件状态</td>
</tr>
<tr>
<td style="text-align:center">git diff</td>
<td style="text-align:center">尚未暂存的文件更新了哪些地方</td>
</tr>
<tr>
<td style="text-align:center">git diff –cached\staged</td>
<td style="text-align:center">已暂存将要下次提交的内容更新的地方</td>
</tr>
<tr>
<td style="text-align:center">git commit -m xxx</td>
<td style="text-align:center">已暂存到已修改状态</td>
</tr>
<tr>
<td style="text-align:center">git  commit -a</td>
<td style="text-align:center">跳过使用暂存区域</td>
</tr>
<tr>
<td style="text-align:center">git  rm</td>
<td style="text-align:center">移除暂存区的文件</td>
</tr>
<tr>
<td style="text-align:center">git log</td>
<td style="text-align:center">查看提交历史</td>
</tr>
<tr>
<td style="text-align:center">git log -p -2</td>
<td style="text-align:center">仅显示最近2次提交</td>
</tr>
<tr>
<td style="text-align:center">git log –stat</td>
<td style="text-align:center">查看每次提交的简略信息</td>
</tr>
<tr>
<td style="text-align:center">git log –pretty=oneline</td>
<td style="text-align:center">一行显示日志</td>
</tr>
<tr>
<td style="text-align:center">git log –pretty=format:”%h - %an, %ar : %s”</td>
<td style="text-align:center">按照格式输出</td>
</tr>
<tr>
<td style="text-align:center">git log –pretty=format:”%h %s” –graph</td>
<td style="text-align:center">图形输出</td>
</tr>
<tr>
<td style="text-align:center">git commit –amend</td>
<td style="text-align:center">将暂存区文件提交，上一次的 快照会保持不变</td>
</tr>
<tr>
<td style="text-align:center">git reset  HEAD  文件</td>
<td style="text-align:center">取消暂存</td>
</tr>
<tr>
<td style="text-align:center">git checkout –文件名</td>
<td style="text-align:center">撤销暂存</td>
</tr>
<tr>
<td style="text-align:center">git tag</td>
<td style="text-align:center">查看标签</td>
</tr>
<tr>
<td style="text-align:center">git show</td>
<td style="text-align:center">查看日志</td>
</tr>
<tr>
<td style="text-align:center">git push origin v1.5</td>
<td style="text-align:center">推送标签</td>
</tr>
<tr>
<td style="text-align:center">git push origin –tags</td>
<td style="text-align:center">推送多个标签</td>
</tr>
<tr>
<td style="text-align:center">git checkout -b branchname  tagname</td>
<td style="text-align:center">检出标签</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>git log 常用命令</p>
<table>
<thead>
<tr>
<th><code>-p</code></th>
<th>按补丁格式显示每个更新之间的差异。</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--stat</code></td>
<td>显示每次更新的文件修改统计信息。</td>
</tr>
<tr>
<td><code>--shortstat</code></td>
<td>只显示 –stat 中最后的行数修改添加移除统计。</td>
</tr>
<tr>
<td><code>--name-only</code></td>
<td>仅在提交信息后显示已修改的文件清单。</td>
</tr>
<tr>
<td><code>--name-status</code></td>
<td>显示新增、修改、删除的文件清单。</td>
</tr>
<tr>
<td><code>--abbrev-commit</code></td>
<td>仅显示 SHA-1 的前几个字符，而非所有的 40 个字符。</td>
</tr>
<tr>
<td><code>--relative-date</code></td>
<td>使用较短的相对时间显示（比如，“2 weeks ago”）。</td>
</tr>
<tr>
<td><code>--graph</code></td>
<td>显示 ASCII 图形表示的分支合并历史。</td>
</tr>
<tr>
<td><code>--pretty</code></td>
<td>使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）。</td>
</tr>
</tbody>
</table>
<p> 缺少记录</p>
<p>远程仓库 记录</p>
<p>git 别名</p>
<p>标签：</p>
<p> 附注标签：git tag -a v1.1 -m ‘附注’</p>
<p>轻量标签： git tag v1.1</p>
<p> 忽略文件</p>
<p> .gitignore  </p>
<p>git  查看状态   </p>
<h3 id="gitlab搭建"><a href="#gitlab搭建" class="headerlink" title="gitlab搭建"></a>gitlab搭建</h3><p><strong>安装配置依赖项</strong></p>
<ol>
<li>sudo yum install curl policycoreutils openssh-server openssh-clients</li>
<li>sudo systemctl enable sshd</li>
<li>sudo systemctl start sshd</li>
<li>sudo yum install postfix</li>
<li>sudo systemctl enable postfix</li>
<li>sudo systemctl start postfix</li>
<li>sudo firewall-cmd –permanent –add-service=http</li>
<li>sudo systemctl reload firewalld</li>
</ol>
<p><strong>添加GitLab仓库,并安装到服务器上</strong></p>
<ol>
<li>curl -sS <a href="http://packages.gitlab.cc/install/gitlab-ce/script.rpm.sh" target="_blank" rel="noopener">http://packages.gitlab.cc/install/gitlab-ce/script.rpm.sh</a> | sudo bash</li>
<li>sudo yum install gitlab-ce</li>
</ol>
<h4 id="启动GitLab"><a href="#启动GitLab" class="headerlink" title="启动GitLab"></a>启动GitLab</h4><ol>
<li><p>sudo gitlab-ctl reconfigure</p>
<p>gitlab-ctl reconfigure  更新配置文件</p>
</li>
</ol>
<p>gitlab-ctl tail 查看日志</p>
<p>默认配置地址 /etc/gilab/</p>
<p>访问之后页面为502，跟踪日志为超时，需要配置</p>
<p>gitlab_rails[‘webhook_timeout’] = 90 </p>
<p>gitlab_rails[‘git_timeout’]=90</p>
<p>之后就可以了。</p>
<p>卸载gitlab</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一、停止gitlab</span><br><span class="line">sudo gitlab-ctl stop</span><br><span class="line">二、卸载gitlab</span><br><span class="line">sudo rpm -e gitlab-ce</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/05/git/" data-id="ck8h6wq6r0008ecvasmzd7cal" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-zookeeper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/02/zookeeper/" class="article-date">
  <time datetime="2018-02-02T07:22:25.000Z" itemprop="datePublished">2018-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/02/zookeeper/">zookeeper</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###分布式环境的特点</p>
<p>分布性</p>
<p>并发性</p>
<p>同时访问一个节点</p>
<p>无序性</p>
<p>进程之间的消息通信，会出现顺序不一致的问题</p>
<p>###分布式环境下面临的问题</p>
<p>网络通信（网络本身不可靠）</p>
<p>网络分区/脑裂（当网络发生异常导致分布式系统中部分节点之间的网络延时不断增大，最终导致组成分布式架构的所有节点，只有部分节点能够通信）</p>
<p>三态（在分布式架构除了成功、失败、超时）</p>
<p>分布式事务</p>
<p>ACID</p>
<p>原子性、一致性、隔离性、持久性</p>
<h3 id="中心化和去中心化"><a href="#中心化和去中心化" class="headerlink" title="中心化和去中心化"></a>中心化和去中心化</h3><p>冷备或者热备</p>
<p>分布式架构，很多的架构思想采用的是当集群发生故障的时候，集群的人群会自动选举出一个新的领导。</p>
<p>最典型的：zookeeper/etcd</p>
<h3 id="经典的CAP-BASE理论"><a href="#经典的CAP-BASE理论" class="headerlink" title="经典的CAP/BASE理论"></a>经典的CAP/BASE理论</h3><p>CAP</p>
<p>C一致性  Consistency  所有的节点时刻保持一致</p>
<p>A 可用性 Availability  每个请求都能收到一个项目，无论相应成功或者失败</p>
<p>P 分区容错 （Partition-tolerance）表示系统出现脑裂以后，可能导致某些server与集群中的其他机器失去联系</p>
<p>CP/AP</p>
<p>CAP 理论仅仅适用于原子读写Nosql场景，不适用于数据库系统</p>
<p>BASE</p>
<p>基于CAP理论，CAP理论并不适用于数据库事务（因为更新一些错误的数据而导致数据紊乱，无论什么样的数据库高可用方案都是徒劳），XA事务虽然可以保证数据库在分布式系统下的ACID特性，但是会带来性能方面的影响</p>
<p>basically avaiable 基本可用，数据库采用分片模式，把100w的用户数据分在5个实例上。如果破坏了其中的一个案例，仍然可以保证百分八十用户可用。</p>
<p>soft-state   软状态，，在基于clien-server模式的系统中，server端是否有状态，决定了系统是否具备良好的水平扩展、负载均衡、故障恢复等特性。Server端承诺会维护client端状态数据，这个状态仅仅会维持一小段时间。这段时间后，server端就会丢弃这个状态，恢复正常状态。如支付订单。</p>
<p>Eventually consistent  数据的最终一致性</p>
<h3 id="初步认识zookeeper"><a href="#初步认识zookeeper" class="headerlink" title="初步认识zookeeper"></a>初步认识zookeeper</h3><p>zookeeper是一个开源的分布式协调服务，是由雅虎创建的，基于google chubby。</p>
<p>zookeeper是分布式数据一致性的解决方案</p>
<p>数据的发布/订阅（配置中心disconf）、负载均衡（dubbo+zookeeper）、命名服务、master选举（kafka、hadoop、hbase）、分布式队列、分布式锁。</p>
<p>zookeeper特性</p>
<p>顺序一致性</p>
<p>从同一个客户端发起的事务请求，最终会严格按照顺序被应用到zookeeper中</p>
<p>原子性</p>
<p>所有事务请求的处理结果在整个集群中的所有机器上的应用情况是一致的，也就是说，要么整个集群中的所有机器都成功应用了某一事务、要么全都不应用。</p>
<p>可靠性</p>
<p>一旦服务器成功应用了某个事务数据，并且客户端做了响应，那么这个数据在整个集群中一定是同步并且保留下来的</p>
<p>实时性</p>
<p>一旦一个事务被成功应用，客户端就能够立即从服务器端读取到事务变更后的最新数据状态（zookeeper仅仅保证在一定时间内，近实时）</p>
<h3 id="zookeeper安装"><a href="#zookeeper安装" class="headerlink" title="zookeeper安装"></a>zookeeper安装</h3><p>1、下载zookeeper安装包</p>
<p>2、解压zookeeper ，tar -zxvf  安装包</p>
<p>3、cd 到zk_home/conf ，cp一份</p>
<p>4、查看命令</p>
<p>sh  zkServer.sh  xxx</p>
<p>zkServer.sh {start|start-foreground|stop|restart|status|upgrade|print-cmd}</p>
<p>2181是zookeeper默认的端口号</p>
<p>5、连接客户端</p>
<p>sh zkCli.sh -server ip:port</p>
<h3 id="集群环境"><a href="#集群环境" class="headerlink" title="集群环境"></a>集群环境</h3><p>zookeeper 集群，包含三种角色：leader/follower/observer</p>
<p>leader:接受所有Follower的提案请求并同意协调发起提案的投票。负责所有的Follower进行内部的数据交换（同步）</p>
<p>Follower:直接为客户端服务并参与提案的投票，同时与Leader进行数据交换(同步)</p>
<p>Observer:直接为客户端服务但不参与提案的投票，同时也与Leader进行数据交换(同步)</p>
<p>是一种特殊的zookeeper节点，可以帮助解决zookeeper的扩展性（如果大量的客户端访问我们的zookeeper集群，需要增加zookeeper集群机器数量，从而增加zookeeper集群的性能。导致zookeeper写性能下降，zookeeper的数据变更需要半数以上服务器投票通过，造成网络消耗增加投票成本）</p>
<p>observer 不参与投票，只接收投票结果</p>
<p>不属于zookeeper的关键部位</p>
<p>在zoo.cfg里面增加Peertype=observer</p>
<p>1、修改配置文件（zoo.cfg）</p>
<p>server.id=host:port:port</p>
<p>id的取值范围为1~255,用id来标识该机器在集群中的机器序号</p>
<p>2888表示follower节点与leader节点交换信息的端口号</p>
<p>3181标识leader选举的端口号，是随机的，但是不能冲突。</p>
<p>sever.1=192.168.233.129:2888:3181<br>server.2=192.168.233.130:2888:3181<br>server.3=192.168.233.131:2888:3181</p>
<p>2、创建myid</p>
<p>在每一个服务器的dataDir目录下创建一个myid的文件，文件就一行就行了，内容为 id。</p>
<p>###zoo.cfg 配置文件分析</p>
<p>tickTime</p>
<p>  zoookeeper中最小的时间单位变量</p>
<p>initLimit</p>
<p> follower节点启动后与leader节点完成数据同步的时间</p>
<p>syncLimit</p>
<p>leader节点和follower节点进行心跳检测的最大延时时间</p>
<p>dataDir</p>
<p>表示zookeeper服务器存储快照文件的目录，默认放在dataDir目录下</p>
<p>dataLogDir</p>
<p>事务日志</p>
<p>clientPort</p>
<p>表示客户端和服务端建立连接的端口号</p>
<h3 id="zookeeper中的一些概念"><a href="#zookeeper中的一些概念" class="headerlink" title="zookeeper中的一些概念"></a>zookeeper中的一些概念</h3><p>1、数据模型</p>
<p>zookeeper的数据模型和文件系统类似，每个节点称为znode，是zookeeper中的最小数据单元。每个znode上都可以保存数据和挂载子节点。从而构成一个层次化的属性结构。</p>
<p>持久化节点：节点创建后会一直存在服务器上，直到主动删除</p>
<p>持久化有序节点：每个节点都会为他的一级节点维护一个顺序</p>
<p>临时节点：临时节点的生命周期和客户端的会话保持一致，当客户端会话失效，该节点自动清理。</p>
<p>临时有序节点：在临时节点上多了一个顺序性的特性</p>
<p>会话</p>
<h3 id="zookeeper的命令操作"><a href="#zookeeper的命令操作" class="headerlink" title="zookeeper的命令操作"></a>zookeeper的命令操作</h3><p>create [-s][-e] path data acl</p>
<p>-s表示 节点是否有序 </p>
<p>-e表示是否为临时节点</p>
<p>默认情况下是持久化节点</p>
<p>get path [watch]</p>
<p>获得指定的path的信息</p>
<p>set path data [version]</p>
<p>修改节点path对应 的data</p>
<p>乐观锁</p>
<p>数据库里有一个version字段去控制数据行的版本号</p>
<p>delete path [version]</p>
<p>删除节点</p>
<h3 id="stat信息"><a href="#stat信息" class="headerlink" title="stat信息"></a>stat信息</h3><p>[zk: localhost:2181(CONNECTED) 11] get /hp<br>111<br>cZxid = 0x100000002   节点被创建时的事务id<br>ctime = Wed Feb 07 05:43:57 EST 2018   节点被创建时的时间<br>mZxid = 0x100000002  节点被最后一次更新的事务id<br>mtime = Wed Feb 07 05:43:57 EST 2018  节点被修改的时间<br>pZxid = 0x10000000a  当前节点下的子节点最后一次被修改的事务id</p>
<p>cversion = 2  子节点的版本号<br>dataVersion = 0   当前节点数据的版本号<br>aclVersion = 0  表示acl的版本号，修改节点权限</p>
<p>ephemeralOwner = 0x0   创建临时节点的时候，会有一个sessionId，它会把值存储到sessionId<br>dataLength = 3  长度</p>
<p>numChildren = 0 子节点数量</p>
<h3 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h3><p>zookkeeper提供了分布式数据发布/订阅，zookeeper允许客户端向服务器端注册一个watcher监听，当服务器端的节点触发指定节点的时候会触发watcher，服务端会向客户端发送一个事件通知。</p>
<p>watcher的通知是一次性，一旦触发一次通知后，该watcher就失效，如果需要永久监听，需要反复注册</p>
<p>EventyType</p>
<p>None: 客户端与服务端成功建立会话</p>
<p>NodeCreated 节点创建</p>
<p>NodeDeleted 节点删除</p>
<p>NodeDataChanged 数据变更，数据内容</p>
<p>NodeChildrenChanged 子节点发生变更：子节点删除、新增的时候才会触发</p>
<p>###ACL</p>
<p>zookeeper提供控制节点访问权限控制的功能，用于有效保证zookeeper中的数据安全性，避免误操作而导致系统出现重大事故。</p>
<p>CREATE/READ/WRITE/DELETE/ADMIN</p>
<p> java API的使用</p>
<p>对数据的增删改查和权限控制</p>
<p>zkclient</p>
<p>curator</p>
<p>curator本身是Netflix公司开源的zookpeeper客户端。</p>
<p>curator-framework  支持 fluent风格，链式操作</p>
<p>curator-replice  提供实现封装</p>
<p>curator 连接重试策略</p>
<p>ExponentalBackoffRetry()  衰减重试</p>
<p>RetryNTime  指定最大重试次数</p>
<p>RetryOnetime 仅重试一次</p>
<p>RetryUnitilElapsed 一直重试直到规定的时间</p>
<h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><p>内存数据和磁盘数据</p>
<p>zookeeper会定时吧数据存储在磁盘上</p>
<p>dataDir 存储的是数据快照</p>
<p>dataLogDir 存储事务日志</p>
<p>zookeeper有三种日志</p>
<p>zookeeper.out  运行日志</p>
<p>快照 存储某一时刻的全量数据</p>
<p>事务日志  事务操作的日志记录</p>
<h3 id="zookeeper的实际应用场景"><a href="#zookeeper的实际应用场景" class="headerlink" title="zookeeper的实际应用场景"></a>zookeeper的实际应用场景</h3><p>zookeeper能够实现的场景</p>
<p>#####订阅发布订阅/配置中心</p>
<p>实现配置信息的集中式管理和数据的动态更新</p>
<p>实现配置中心有2种模式：push、pull</p>
<p>长轮训：</p>
<p>zookeeper采用的是推拉结合的方式。客户单向服务器端注册自己需要关注的节点。一旦节点数据发生变化，那么服务器端就会向客户端发送watcher事件通知。客户端收到通知后，主动到服务器端获取更新后的数据</p>
<p>1、数据量比较小</p>
<p>2、数据内容在运行时发动变更</p>
<p>3、集群中的各个机器共享配置</p>
<p>分布式锁</p>
<p>#####通常实现分布式锁</p>
<p>1、redis</p>
<p>设置key,如果key存在则会返回0， </p>
<p>2、数据方式实现</p>
<p>创建一个表，通过索引唯一的方式</p>
<p>create table(id,name) name增加唯一索引</p>
<p>insert 一条数据xx  ，完成后delete删除这条数据</p>
<p>mysql  for update  方式</p>
<p>3、zookeeper实现</p>
<p>排它锁</p>
<p>共享锁（读锁）</p>
<p>#####负载均衡</p>
<p>请求或者数据分摊到多个计算机单元上。</p>
<p>id生成器</p>
<p>分布式队列</p>
<p>统一命名服务</p>
<p>master选举</p>
<p>保证7*24小时可用，采用master-slave模式</p>
<h3 id="zookeeper的原理分析"><a href="#zookeeper的原理分析" class="headerlink" title="zookeeper的原理分析"></a>zookeeper的原理分析</h3><p>####zookeeper集群角色</p>
<p>leader  是zookeeper是zookeeper集群的核心</p>
<p>1、是事务请求的唯一调度和处理者，保证集群事务处理的顺序性</p>
<p>2、集群内部各个服务器的调度者</p>
<p>follower</p>
<p>1、处理客户端非事务请求，以及转发事务请求给leader服务器</p>
<p>2、参与事务请求的提议的投票（客户端的一个事务请求，需要半数服务器投票通过以后才能通知leader commit、leader会发起一个提案，要求follower投票）</p>
<p>3、参与leader选举的投票</p>
<p>observer</p>
<p>观察zookeeper集群中最新状态的变化并将这些状态同步到observer服务器上。</p>
<p>增加observer不影响集群中事务处理能力，同时还能提升集群中 的非事务处理能力。</p>
<h4 id="zookeeper的集群组成"><a href="#zookeeper的集群组成" class="headerlink" title="zookeeper的集群组成"></a>zookeeper的集群组成</h4><p>zookeeper一般是由2n+1台服务器组成（因为他们的投票需要过半） </p>
<h4 id="leader选举"><a href="#leader选举" class="headerlink" title="leader选举"></a>leader选举</h4><p>leaderElection、AuthcFastLeaderElection、FastLeaderElection，默认是FastLeaderElection</p>
<p>选举算法</p>
<p>FastLeaderElection</p>
<p>serverid:在配置server集群的时候，给定服务器的表示id(myid)</p>
<p>zxid:服务器在运行时产生的数据id，zxid的值越大，表示数据越新</p>
<p>Epoch:选举的轮训</p>
<p>server的状态：Looking（第一次初始化启动）、Following、Observering,Leading</p>
<p>Looking</p>
<p>1、所有在集群中的server都会推荐自己为leader，然后把(myid、zxid、epoch)作为广播信息，广播给集群中的其他server，然后等待服务器返回</p>
<p>2、每个服务器都会接收来自集群中的其他服务器的投票，集群中的每个服务器在接受到投票后，开始判断投票的有效性</p>
<p>3、统计投票</p>
<h4 id="zab协议的原理"><a href="#zab协议的原理" class="headerlink" title="zab协议的原理"></a>zab协议的原理</h4><p>1、在zookeeper的主备模式下，通过zab协议来保证集群中各个副本的数据一致性</p>
<p>2、zookeeper使用的是单一的主进程来接收并处理所有的是武清区，并采用zab协议，把数据的状态变更以事务请求的形式广播到其他节点</p>
<p>3、zab协议在主备模型架构中，保证了同一时刻只能有一个主进程来广播服务器的状态变更。</p>
<p>4、所有的事务请求必须由全局唯一的服务器来协调处理。这个服务器叫leader，其他的叫follower，leader节点主要负责把客户端的事务请求转化成一个事务提议(proposal)，并分发给集群中的所有follower节点，再等待所有follower节点的回，一旦超过半数服务器进行了正确的反馈，那么leader就会commit这条消息。</p>
<p>zab功能</p>
<p>1、崩溃恢复</p>
<p>2、原子广播</p>
<p>a、什么情况下zab协议进入崩溃恢复模式</p>
<p>1、服务器启动时</p>
<p>2、当leader服务器出现网络中断、崩溃或者重启的情况</p>
<p>3、集群中已经不存在过半的服务器与该leader保持正常通信</p>
<p>b、zab协议进入崩溃恢复模式会做什么</p>
<p>当leader出现问题 ，zab协议进入崩溃恢复模式，并且选举出新的leader。当新的leader选举出来以后，如果集群中已经有过半的机器完成了leader服务器的状态同步（数据同步），退出崩溃恢复，进入消息广播模式</p>
<p>当新的机器加入到集群中的时候，如果已经存在leader服务器，那么新加入的服务器会自觉进入数据恢复模式，找到leader进行数据同步。</p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>假设一个事务在leader服务器被提交了，并且已经有过半的follower返回了ack，在leader节点把commit消息发送给folower机器之前，leader服务挂了怎么办</p>
<p>zab协议，一定需要保证已经被leader提交的事务也能够被follower提交</p>
<p>zab协议要保证在崩溃恢复过程中跳过那些已经被丢弃的事务</p>
<h4 id="zookeeper数据模型"><a href="#zookeeper数据模型" class="headerlink" title="zookeeper数据模型"></a>zookeeper数据模型</h4><p>临时节点（有序节点）持久化节点</p>
<p>原子性：要么同时成功，要么同时失败</p>
<p>单一视图：无论客户端连接到哪个服务器，所看到的模式都是一样的</p>
<p>可靠性：一旦服务器端提交了一个事务并且获得服务器端返回成功的标志，那么这个事务所引起的服务器端的变更会一直保留</p>
<p>实时性：近实时</p>
<p>zookeeper不是用来存储数据的，通过监控数据状态的变化，达到基于数据的集群管理。</p>
<h4 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h4><p>not_connected -&gt; connecting -&gt;connected -&gt; close</p>
<p>#### </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/02/zookeeper/" data-id="ck8h6wq88000zecvaful0lqa1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-gradle" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/xiaojiang/2018/02/01/gradle/" class="article-date">
  <time datetime="2018-02-01T07:16:52.000Z" itemprop="datePublished">2018-02-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/xiaojiang/2018/02/01/gradle/">gradle</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangpu311.github.io/xiaojiang/2018/02/01/gradle/" data-id="ck8h6wq6g0002ecvavdr3olf9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/xiaojiang/page/2/">&laquo; Prev</a><a class="page-number" href="/xiaojiang/">1</a><a class="page-number" href="/xiaojiang/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/xiaojiang/page/4/">4</a><a class="extend next" rel="next" href="/xiaojiang/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/xiaojiang/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/xiaojiang/tags/spring源码/">spring源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/xiaojiang/tags/分销/">分销</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/xiaojiang/tags/python/" style="font-size: 10px;">python</a> <a href="/xiaojiang/tags/spring源码/" style="font-size: 10px;">spring源码</a> <a href="/xiaojiang/tags/分销/" style="font-size: 10px;">分销</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/xiaojiang/archives/2018/01/">January 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/xiaojiang/2019/09/05/spring-boot/">(no title)</a>
          </li>
        
          <li>
            <a href="/xiaojiang/2019/02/27/正则表达式/">正则表达式</a>
          </li>
        
          <li>
            <a href="/xiaojiang/2019/02/22/并发编程/">并发编程</a>
          </li>
        
          <li>
            <a href="/xiaojiang/2019/01/24/mybatis/">mybatis</a>
          </li>
        
          <li>
            <a href="/xiaojiang/2019/01/18/java面试题/">java面试题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 小江<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/xiaojiang/" class="mobile-nav-link">Home</a>
  
    <a href="/xiaojiang/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/xiaojiang/fancybox/jquery.fancybox.css">
  <script src="/xiaojiang/fancybox/jquery.fancybox.pack.js"></script>


<script src="/xiaojiang/js/script.js"></script>



  </div>
</body>
</html>